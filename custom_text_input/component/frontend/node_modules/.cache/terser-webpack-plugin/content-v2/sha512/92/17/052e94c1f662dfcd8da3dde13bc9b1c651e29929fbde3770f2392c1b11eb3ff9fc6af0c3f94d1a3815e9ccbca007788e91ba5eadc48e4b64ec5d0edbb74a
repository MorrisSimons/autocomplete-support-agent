{"map":{"version":3,"sources":["static/js/main.0fde472a.chunk.js"],"names":["this","push","14","module","__webpack_exports__","__webpack_require__","r","react","react_default","n","react_dom","react_dom_default","objectSpread2","objectWithoutProperties","dist","_excluded","_excluded2","streamlit_copilot_Copilot","[object Object]","super","arguments","userTextarea","suggestionTextarea","state","text","suggestion","isFocused","textAreaIsFocused","requestsThisMinute","currentMinute","Math","floor","Date","now","totalRequests","successfulRequests","failedRequests","inputCost","outputCost","totalCost","debounceTimer","render","theme","props","a","createElement","height_int","args","font_fam","font","f_height","f_focused","primaryColor","f_not_focused","secondaryBackgroundColor","style","fontSize","color","textColor","marginBottom","padding","backgroundColor","borderRadius","border","display","justifyContent","alignItems","toFixed","onClick","resetCounters","cursor","title","tabIndex","height","width","overflowY","overflowX","position","onFocus","_onFocus","onBlur","_onBlur","marginLeft","fontFamily","marginTop","whiteSpace","outline","base","value","readOnly","ref","textarea","onChange","onKeyDown","_onTextAreaBlur","onScroll","getTextWidth","tempSpan","document","visibility","window","getComputedStyle","textContent","body","appendChild","textWidth","offsetWidth","removeChild","forceUpdate","event","target","setState","clearTimeout","timer","setTimeout","trim","api_upl","callApi","then","key","preventDefault","prevState","syntheticEvent","setComponentValue","abortController","AbortController","executeToolCalls","async","results","toolCall","toolCalls","_toolCall$function","_toolCall$function2","functionName","function","name","JSON","parse","console","log","concat","toolResult","executeTool","searchQuery","query","enhancedResult","toolName","toString","String","pineconeApiKey","pineconeIndexName","openaiApiKey","embeddingResponse","fetch","method","headers","Authorization","Content-Type","stringify","model","input","ok","Error","status","queryEmbedding","json","data","embedding","pineconeHost","indexUrl","includes","searchResponse","Api-Key","vector","topK","includeMetadata","searchData","matches","length","map","match","_match$metadata","_match$metadata2","_match$metadata3","_match$metadata4","metadata","source","content","filter","result","count","error","makeFollowUpCall","apiUrl","userInput","toolResults","followUpPrompt","join","_this$props$args","prompt_template","api_key","questionText","question_title","model_kwargs","Object","isChatApi","replace","followUpAbortController","payload","validParams","max_tokens","temperature","top_p","stop","messages","role","stream","prompt","echo","response","signal","responseJson","fullResponse","choices","message","extractedAnswer","answerTagIndex","indexOf","substring","endTagIndex","abort","Promise","resolve","_this$props$args2","api_url","tools","type","description","parameters","properties","required","tool_choice","_responseJson$usage","_responseJson$usage2","errorText","inputTokens","usage","prompt_tokens","outputTokens","completion_tokens","inputPrice","outputPrice","estimatedInputTokens","ceil","newInputCost","newOutputCost","tool_calls","finalResponse","thinkTagIndex","endThinkIndex","scrollTop","suggestionLeft","left","streamlit_copilot","StrictMode","getElementById","7","exports"],"mappings":"CAACA,KAAoC,8BAAIA,KAAoC,+BAAK,IAAIC,KAAK,CAAC,CAAC,GAAG,CAE1FC,GACA,SAAUC,EAAQC,EAAqBC,GAE7C,aAEAA,EAAoBC,EAAEF,GAGtB,IAAIG,EAAQF,EAAoB,GAC5BG,EAA6BH,EAAoBI,EAAEF,GAGnDG,EAAYL,EAAoB,GAChCM,EAAiCN,EAAoBI,EAAEC,GAGvDE,EAAgBP,EAAoB,GAGpCQ,EAA0BR,EAAoB,GAG9CS,EAAOT,EAAoB,GAG/B,MAAMU,EAAU,CAAC,kBAAkB,UAAU,SAAS,aAAa,SAAS,OAAO,kBAAkBC,EAAW,CAAC,kBAAkB,UAAU,UAAU,SAAS,aAAa,SAAS,OAAO,kBAAkB,MAAMC,UAAkCH,EAAqC,EAAEI,cAAcC,SAASC,WAAWpB,KAAKqB,aAAa,KAAKrB,KAAKsB,mBAAmB,KAAKtB,KAAKuB,MAAM,CAACC,KAAO,GAAGC,WAAa,GAAGC,WAAY,EAAMC,mBAAoB,EAAMC,mBAAmB,EAAEC,cAAcC,KAAKC,MAAMC,KAAKC,MAAM,KAAOC,cAAc,EAAEC,mBAAmB,EAAEC,eAAe,EAAEC,UAAU,EAAEC,WAAW,EAAEC,UAAU,EAAEC,cAAc,MAAMxC,KAAKyC,OAAO,KAAK,MAAKC,MAACA,GAAO1C,KAAK2C,MAAM,IAAID,EAAO,OAAmBlC,EAAcoC,EAAEC,cAAc,MAAM,KAAK,uDAAwD,MAAMC,EAAW9C,KAAK2C,MAAMI,KAAa,OAAQC,EAASN,EAAMO,KAAWC,EAASJ,EAAW,KAAWK,EAAU,aAAaT,EAAMU,aAAmBC,EAAc,aAAaX,EAAMY,yBAAyB,OAAmB9C,EAAcoC,EAAEC,cAAc,MAAM,KAAkBrC,EAAcoC,EAAEC,cAAc,MAAM,CAACU,MAAM,CAACC,SAAS,MAAMC,MAAMf,EAAMgB,UAAUC,aAAa,QAAQC,QAAQ,QAAQC,gBAAgBnB,EAAMmB,gBAAgBC,aAAa,QAAQC,OAAO,aAAarB,EAAMY,yBAAyBU,QAAQ,OAAOC,eAAe,gBAAgBC,WAAW,WAAwB1D,EAAcoC,EAAEC,cAAc,MAAM,KAAkBrC,EAAcoC,EAAEC,cAAc,SAAS,KAAK,cAAc,WAAW7C,KAAKuB,MAAMW,cAAc,sBAAsBlC,KAAKuB,MAAMY,mBAAmB,qBAAqBnC,KAAKuB,MAAMa,eAAe,KAAK,qCAAqCpC,KAAKuB,MAAMK,mBAAmB,MAAM5B,KAAK2C,MAAMI,KAAgB,UAAevC,EAAcoC,EAAEC,cAAc,KAAK,MAAmBrC,EAAcoC,EAAEC,cAAc,SAAS,KAAK,SAAS,YAAY7C,KAAKuB,MAAMc,UAAU8B,QAAQ,GAAG,eAAenE,KAAKuB,MAAMe,WAAW6B,QAAQ,GAAG,cAAcnE,KAAKuB,MAAMgB,UAAU4B,QAAQ,IAAiB3D,EAAcoC,EAAEC,cAAc,SAAS,CAACuB,QAAQpE,KAAKqE,cAAcd,MAAM,CAACC,SAAS,QAAQI,QAAQ,cAAcC,gBAAgBnB,EAAMU,aAAaK,MAAM,QAAQM,OAAO,OAAOD,aAAa,QAAQQ,OAAO,WAAWC,MAAM,kBAAkB,uBAAoC/D,EAAcoC,EAAEC,cAAc,MAAM,CAAC2B,SAAS,EAAEjB,MAAM,CAACkB,OAAOvB,EAASwB,MAAM,OAAOX,OAAO/D,KAAKuB,MAAMG,UAAUyB,EAAUE,EAAcS,aAAa,QAAQa,UAAU,SAASC,UAAU,SAASC,SAAS,WAAWhB,gBAAgBnB,EAAMY,0BAA0BwB,QAAQ9E,KAAK+E,SAASC,OAAOhF,KAAKiF,SAAsBzE,EAAcoC,EAAEC,cAAc,WAAW,CAACU,MAAM,CAAC2B,WAAW,QAAQC,WAAWnC,EAASoC,UAAU,QAAQC,WAAW,WAAWX,MAAM,qBAAqBD,OAAO,OAAOV,OAAO,OAAOuB,QAAQ,OAAOT,SAAS,WAAWhB,gBAAgB,cAAcJ,MAAmB,UAAbf,EAAM6C,KAAe,qBAAqB,wBAAwB3B,QAAQ,KAAK4B,MAAMxF,KAAKuB,MAAME,WAAWgE,UAAS,EAAKC,IAAIC,IAAW3F,KAAKsB,mBAAmBqE,KAA0BnF,EAAcoC,EAAEC,cAAc,WAAW,CAACU,MAAM,CAAC2B,WAAW,QAAQC,WAAWnC,EAASoC,UAAU,QAAQC,WAAW,WAAWX,MAAM,qBAAqBD,OAAO,OAAOV,OAAO,OAAOuB,QAAQ,OAAOT,SAAS,WAAWhB,gBAAgB,cAAcJ,MAAMf,EAAMgB,UAAUE,QAAQ,KAAK4B,MAAMxF,KAAKuB,MAAMC,KAAKoE,SAAS5F,KAAK4F,SAASC,UAAU7F,KAAK6F,UAAUb,OAAOhF,KAAK8F,gBAAgBC,SAAS/F,KAAK+F,SAASL,IAAIC,IAAW3F,KAAKqB,aAAasE,QAAiB3F,KAAKgG,aAAaxE,IAAO,IAAIxB,KAAKqB,aAAa,OAAO,EACv+G,MAAM4E,EAASC,SAASrD,cAAc,QAAQoD,EAAS1C,MAAM4C,WAAW,SAASF,EAAS1C,MAAMsB,SAAS,WAAWoB,EAAS1C,MAAM8B,WAAW,WAAWY,EAAS1C,MAAM4B,WAAWiB,OAAOC,iBAAiBrG,KAAKqB,cAAc8D,WAAWc,EAAS1C,MAAMC,SAAS4C,OAAOC,iBAAiBrG,KAAKqB,cAAcmC,SAASyC,EAASK,YAAY9E,EAAK0E,SAASK,KAAKC,YAAYP,GAAU,MAAMQ,EAAUR,EAASS,YAAYR,SAASK,KAAKI,YAAYV,GAElb,OAAOQ,EADU,GACazG,KAAK+F,SAAS,KAAK/F,KAAK4G,eAAgB5G,KAAK4F,SAASiB,IAAQ,MAAMrF,EAAKqF,EAAMC,OAAOtB,MAAMxF,KAAK+G,SAAS,CAACvF,KAAAA,EAAKC,WAAW,KAC3H,OAA3BzB,KAAKuB,MAAMiB,eAAsB4D,OAAOY,aAAahH,KAAKuB,MAAMiB,eACnE,MAAMyE,EAAMb,OAAOc,WAAW,KAAK,GAAiB,KAAd1F,EAAK2F,OAAY,CAAC,MAAMC,EAAQpH,KAAK2C,MAAMI,KAAc,QAAE/C,KAAKqH,QAAQ7F,EAAK4F,GAASE,KAAK7F,IAAyC,KAAzBzB,KAAKuB,MAAMC,KAAK2F,QAAanH,KAAK+G,SAAS,CAACtF,WAAWA,GAAY,KACpNzB,KAAK4G,oBAAwB,KAC7B5G,KAAK+G,SAAS,CAACvE,cAAcyE,KAAUjH,KAAK6F,UAAUgB,IAAuB,QAAZA,EAAMU,MAAaV,EAAMW,iBAAiBxH,KAAK+G,SAASU,IAAW,CAAEjG,KAAKiG,EAAUhG,WAAWA,WAAW,KAAK,KAChL,MAAMiG,EAAe,CAACZ,OAAO,CAACtB,MAAMxF,KAAKuB,MAAMC,OAAOxB,KAAK4F,SAAS8B,OAAsB1H,KAAK8F,gBAAgB,KAAK9F,KAAK+G,SAAS,CAACpF,mBAAkB,GAAO,KAAKb,EAAwB,EAAE6G,kBAAkB3H,KAAKuB,MAAMC,MAAMxB,KAAK+G,SAAS,CAACtF,WAAW,QAAUzB,KAAK+E,SAAS,KAAK/E,KAAK+G,SAAS,CAACrF,WAAU,KAAS1B,KAAKiF,QAAQ,KAAKjF,KAAK+G,SAAS,CAACrF,WAAU,KAAU1B,KAAKqE,cAAc,KAAKrE,KAAK+G,SAAS,CAAC7E,cAAc,EAAEC,mBAAmB,EAAEC,eAAe,EAAER,mBAAmB,EAAES,UAAU,EAAEC,WAAW,EAAEC,UAAU,KAAMvC,KAAK4H,gBAAgB,IAAIC,gBAAkB7H,KAAK8H,iBAAiBC,MAAAA,IAAkB,MAAMC,EAAQ,GAAG,IAAI,MAAMC,KAAYC,EAAU,CAAC,IAAIC,EAAmBC,EAAoB,MAAMC,EAAsD,QAAxCF,EAAmBF,EAASK,gBAAuC,IAArBH,OAA4B,EAAOA,EAAmBI,KAAWxF,EAAKyF,KAAKC,OAAiD,QAAzCL,EAAoBH,EAASK,gBAAwC,IAAtBF,OAA6B,EAAOA,EAAoBhH,YAAY,MAA8E,GAAxEsH,QAAQC,IAAI,mBAAmBC,OAAOP,EAAa,eAAetF,GAAwB,0BAAfsF,EAAuC,CACvjC,MAAMQ,QAAiB7I,KAAK8I,YAAYT,EAAatF,GAC/CgG,EAAYhG,EAAKiG,OAAO,gBAAsBC,EAAe,kBAAmBL,OAAOG,EAAY,SAAUH,OAAOC,EAAW,4FAA4Fb,EAAQ/H,KAAKgJ,QAAsBjB,EAAQ/H,KAAK,iBAAiB2I,OAAOP,IAAiB,OAAOL,GAAUhI,KAAK8I,YAAYf,MAAMmB,EAASnG,KAAQ,GAAc,0BAAXmG,EAAmC,CACzZ,IAAIF,EAAM,GAAoCA,EAAV,kBAAbjG,EAAKiG,MAAwBjG,EAAKiG,MAAejG,EAAKiG,OAA2B,kBAAbjG,EAAKiG,MAC1FjG,EAAKiG,MAAMG,YAAY,GAAeC,OAAOrG,EAAKiG,OAAO,IAAKN,QAAQC,IAAI,sBAAuBC,OAAOI,EAAM,MACpH,MAAMK,EAAerJ,KAAK2C,MAAMI,KAAuB,iBAAQuG,EAAkBtJ,KAAK2C,MAAMI,KAA0B,oBAAQwG,EAAavJ,KAAK2C,MAAMI,KAAqB,eAAE,GAAGsG,GAAgBC,GAAmBC,EAAc,IACjO,MAAMC,QAAwBC,MAAM,uCAAuC,CAACC,OAAO,OAAOC,QAAQ,CAACC,cAAgB,UAAUhB,OAAOW,GAAcM,eAAe,oBAAoBtD,KAAKiC,KAAKsB,UAAU,CAACC,MAAM/J,KAAK2C,MAAMI,KAAsB,iBAAG,yBAAyBiH,MAAMhB,MAAU,IAAIQ,EAAkBS,GAAI,MAAM,IAAIC,MAAM,qBAAqBtB,OAAOY,EAAkBW,SAAU,MAAyDC,SAA/BZ,EAAkBa,QAA0CC,KAAK,GAAGC,UACrZC,GAA9CxK,KAAK2C,MAAMI,KAA2B,qBAAqB/C,KAAK2C,MAAMI,KAAoB,eAAG,2BACvH,IAAI0H,EACJA,EADgBD,EAAaE,SAAS,SAASF,EAAaE,SAAS,gBAC5D,WAAW9B,OAAO4B,EAAa,UAC/B,GAAG5B,OAAO4B,EAAa,aAAa5B,OAAOU,EAAkB,UAAWZ,QAAQC,IAAI,uBAAuBC,OAAO6B,IAAW,MAAME,QAAqBlB,MAAMgB,EAAS,CAACf,OAAO,OAAOC,QAAQ,CAACiB,UAAUvB,EAAeQ,eAAe,oBAAoBtD,KAAKiC,KAAKsB,UAAU,CAACe,OAAOT,EAAeU,KAAK9K,KAAK2C,MAAMI,KAAiB,YAAG,EAAEgI,iBAAgB,MAAS,IAAIJ,EAAeV,GAAI,MAAM,IAAIC,MAAM,uBAAuBtB,OAAO+B,EAAeR,SAAU,MAAMa,QAAiBL,EAAeN,OAAO,GAAGW,EAAWC,SAASD,EAAWC,QAAQC,OAAO,EAAE,CAAC,MAAMlD,EAAQgD,EAAWC,QAAQE,IAAIC,IAAQ,IAAIC,EAAgBC,EAAiBC,EAAiBC,EAAiB,MAAM,CAACjH,OAA0C,QAAlC8G,EAAgBD,EAAMK,gBAAoC,IAAlBJ,OAAyB,EAAOA,EAAgB9G,QAAQ,WAAWmH,QAA4C,QAAnCJ,EAAiBF,EAAMK,gBAAqC,IAAnBH,OAA0B,EAAOA,EAAiBI,SAAS,YAAYlK,MAA0C,QAAnC+J,EAAiBH,EAAMK,gBAAqC,IAAnBF,OAA0B,EAAOA,EAAiB/J,QAA4C,QAAnCgK,EAAiBJ,EAAMK,gBAAqC,IAAnBD,OAA0B,EAAOA,EAAiBG,UAAU,gBAAiBC,OAAOC,GAAsB,eAAdA,EAAOrK,MAAqB,GAAGwG,EAAQkD,OAAO,EAAyC,OAAtCxC,QAAQC,IAAI,iBAAiBX,GAAgBQ,KAAKsB,UAAU,CAACgC,MAAM9D,EAAQkD,OAAOlD,QAAQA,GAAS,KAAK,GAC7xC,MAAM,GAAI,MAAM+D,GAAqD,OAA9CrD,QAAQqD,MAAM,yBAAyBA,GAAa,GAC3E,MAAM,GAAI,MAAM,IAAK/L,KAAKgM,iBAAiBjE,MAAMkE,EAAOC,EAAUC,KAAe,MAAMC,EAAe,qJAAqJxD,OAAOuD,EAAYE,KAAK,QAAQ,4BAA6BzD,OAAOsD,EAAU,8HAAqII,EAAiBtM,KAAK2C,MAAMI,MAAKwJ,gBAACA,EAAeC,QAACA,EAAO/H,OAACA,EAAMU,WAACA,EAAUpB,OAACA,EAAOvC,KAAKiL,EAAYC,eAACA,GAAgBJ,EAAiBK,EAAaC,OAAO/L,EAAyC,EAAhD+L,CAAmDN,EAAiBvL,GAAgI8L,GAAxGN,EAAgBO,QAAQ,SAASL,GAAc,IAAIK,QAAQ,mBAAmBJ,GAAgB,IAAoD,SAAhC1M,KAAK2C,MAAMI,KAAiB,YAAYkJ,EAAOvB,SAAS,sBACj2BqC,EAAwB,IAAIlF,gBAAkB,IAAImF,EAAQ,GAAGH,EAAU,CAAC,MAAMI,EAAY,GAAMN,EAAa5C,QAAMkD,EAAYlD,MAAM4C,EAAa5C,OAAS4C,EAAaO,aAAWD,EAAYC,WAAWP,EAAaO,YAAcP,EAAaQ,cAAYF,EAAYE,YAAYR,EAAaQ,aAAeR,EAAaS,QAAMH,EAAYG,MAAMT,EAAaS,OAAST,EAAaU,OAAKJ,EAAYI,KAAKV,EAAaU,MAAKL,EAAQJ,OAAOhM,EAA+B,EAAtCgM,CAAyCA,OAAOhM,EAA+B,EAAtCgM,CAAyC,CAACU,SAAS,CAAC,CAACC,KAAK,OAAO5B,QAAQS,KAAkBa,GAAa,GAAG,CAACO,QAAO,SAAcR,EAAQJ,OAAOhM,EAA+B,EAAtCgM,CAAyCA,OAAOhM,EAA+B,EAAtCgM,CAAyC,CAACa,OAAOrB,GAAgBO,GAAc,GAAG,CAACe,MAAK,IAAS,MAAM/D,EAAQ,CAACE,eAAe,oBAAuB2C,IAAS7C,EAAuB,cAAE,UAAUf,OAAO4D,IAAU,IAAI,MAAMmB,QAAelE,MAAMwC,EAAO,CAACvC,OAAO,OAAOC,QAAQA,EAAQpD,KAAKiC,KAAKsB,UAAUkD,GAASY,OAAOb,EAAwBa,SAAS,IAAID,EAAS1D,GAAI,MAAM,IAAIC,MAAM,uBAAuBtB,OAAO+E,EAASxD,SAAU,MAAM0D,QAAmBF,EAAStD,OAAO,IAAIyD,EAAa,GAAG,GAAGjB,GAAWgB,EAAaE,SAASF,EAAaE,QAAQ,IAAIF,EAAaE,QAAQ,GAAGC,QAASF,EAAaD,EAAaE,QAAQ,GAAGC,QAAQrC,YAAc,CAAA,KAAGkC,EAAaE,SAASF,EAAaE,QAAQ,IAAIF,EAAaE,QAAQ,GAAGvM,MAAgH,OAA1DkH,QAAQqD,MAAM,8BAA8B8B,GAAoB,GAAhHC,EAAaD,EAAaE,QAAQ,GAAGvM,KACr4C,IAAIyM,EAAgB,GAAG,MAAMC,EAAeJ,EAAaK,QAAQ,YAAY,IAAqB,IAAlBD,EAAoB,CAACD,EAAgBH,EAAaM,UAAUF,EAAe,GAAG,MAAMG,EAAYJ,EAAgBE,QAAQ,cAA+B,IAAfE,IAAkBJ,EAAgBA,EAAgBG,UAAU,EAAEC,SAAoBJ,EAAgBH,EAAc,OAAOG,EAAiB,MAAMlC,GAAoD,OAA7CrD,QAAQqD,MAAM,wBAAwBA,GAAa,KAAM/L,KAAKqH,QAAQU,MAAMvG,EAAK4F,KACtX,GAAxEpH,KAAK4H,gBAAgB0G,QAAQtO,KAAK4H,gBAAgB,IAAIC,gBAAmC,KAAdrG,EAAK2F,OAAa,MAAM,GAAI,MAAMtF,EAAcC,KAAKC,MAAMC,KAAKC,MAAM,KAAO,GAAGJ,EAAc7B,KAAKuB,MAAMM,cAAe7B,KAAK+G,SAAS,CAAClF,cAAcA,EAAcD,mBAAmB,SAAU,GAAG5B,KAAKuB,MAAMK,mBAAmB5B,KAAK2C,MAAMI,KAAgB,UACvU,OAAO,IAAIwL,QAAQC,IAAUtH,WAAW,KAAKsH,EAAQxO,KAAKqH,QAAQ7F,EAAK4F,KAAY,OAAU,MAAMqH,EAAkBzO,KAAK2C,MAAMI,MAAKwJ,gBAACA,EAAemC,QAACA,EAAOlC,QAACA,EAAO/H,OAACA,EAAMU,WAACA,EAAUpB,OAACA,EAAOvC,KAAKiL,EAAYC,eAACA,GAAgB+B,EAAkB9B,EAAaC,OAAO/L,EAAyC,EAAhD+L,CAAmD6B,EAAkBzN,GAAkByM,EAAOlB,EAAgBO,QAAQ,SAASL,GAAc,IAAIK,QAAQ,mBAAmBJ,GAAgB,IAItbG,EAA0C,SAAhC7M,KAAK2C,MAAMI,KAAiB,YAAYqE,EAAQsD,SAAS,qBACnEiE,EAAM,CAAC,CAACC,KAAK,WAAWtG,SAAS,CAACC,KAAK,wBAAwBsG,YAAY,kEAA4DC,WAAW,CAACF,KAAK,SAASG,WAAW,CAAC/F,MAAM,CAAC4F,KAAK,SAASC,YAAY,yDAAgDG,SAAS,CAAC,aAAa,IAAIhC,EAAQ,GAAGH,EAAU,CACpT,MAAMI,EAAY,GAAMN,EAAa5C,QAAMkD,EAAYlD,MAAM4C,EAAa5C,OAAS4C,EAAaO,aAAWD,EAAYC,WAAWP,EAAaO,YAAcP,EAAaQ,cAAYF,EAAYE,YAAYR,EAAaQ,aAAeR,EAAaS,QAAMH,EAAYG,MAAMT,EAAaS,OAAST,EAAaU,OAAKJ,EAAYI,KAAKV,EAAaU,MAAKL,EAAQJ,OAAOhM,EAA+B,EAAtCgM,CAAyCA,OAAOhM,EAA+B,EAAtCgM,CAAyC,CAACU,SAAS,CAAC,CAACC,KAAK,OAAO5B,QAAQ8B,KAAUR,GAAa,GAAG,CAAC0B,MAAMA,EAAMM,YAAY,OAAOzB,QAAO,SACrhBR,EAAQJ,OAAOhM,EAA+B,EAAtCgM,CAAyCA,OAAOhM,EAA+B,EAAtCgM,CAAyC,CAACa,OAAOA,GAAQd,GAAc,GAAG,CAACe,MAAK,IAAS,MAAM/D,EAAQ,CAACE,eAAe,oBACrK2C,IAAS7C,EAAuB,cAAE,UAAUf,OAAO4D,IAAU,IAAI,IAAI0C,EAAoBC,EAC5FnP,KAAK+G,SAASU,IAAW,CAAEvF,cAAcuF,EAAUvF,cAAc,KAAK,MAAMyL,QAAelE,MAAMrC,EAAQ,CAACsC,OAAO,OAAOC,QAAQA,EAAQpD,KAAKiC,KAAKsB,UAAUkD,GAASY,OAAO5N,KAAK4H,gBAAgBgG,SAAS,IAAID,EAAS1D,GAAG,CAAC,MAAMmF,QAAgBzB,EAASnM,OAClL,MADyLkH,QAAQqD,MAAM,sBAAsBqD,GACrSpP,KAAK+G,SAASU,IAAW,CAAErF,eAAeqF,EAAUrF,eAAe,KAAW,IAAI8H,MAAM,uBAAuBtB,OAAO+E,EAASxD,SAAUnK,KAAK+G,SAASU,IAAW,CAAE7F,mBAAmB6F,EAAU7F,mBAAmB,EAAEO,mBAAmBsF,EAAUtF,mBAAmB,KAAK,MAAM0L,QAAmBF,EAAStD,OACvSgF,GAAwD,QAA1CH,EAAoBrB,EAAayB,aAAqC,IAAtBJ,OAA6B,EAAOA,EAAoBK,gBAAgB,EAAQC,GAA0D,QAA3CL,EAAqBtB,EAAayB,aAAsC,IAAvBH,OAA8B,EAAOA,EAAqBM,oBAAoB,EAAQC,EAAW1P,KAAK2C,MAAMI,KAAiB,YAAG,IAAW4M,EAAY3P,KAAK2C,MAAMI,KAAwB,mBAAG,GAC3Y6M,EAAqBP,GAAavN,KAAK+N,KAAKpC,EAAOvC,OAAO,GAAqD4E,EAAaF,EAAqB,IAAQF,EAAiBK,GAAjFP,GAAc,GAAuG,IAAQG,EAAY3P,KAAK+G,SAASU,IAAW,CAAEpF,UAAUoF,EAAUpF,UAAUyN,EAAaxN,WAAWmF,EAAUnF,WAAWyN,EAAcxN,UAAUkF,EAAUlF,UAAUuN,EAAaC,KACvY,IAAIjC,EAAa,GAAOE,EAAQ,KAAK,GAAGnB,GAAWgB,EAAaE,SAASF,EAAaE,QAAQ,IAAIF,EAAaE,QAAQ,GAAGC,QAASA,EAAQH,EAAaE,QAAQ,GAAGC,QAAQF,EAAaE,EAAQrC,SAAS,OAAS,CAAA,KAAGkC,EAAaE,SAASF,EAAaE,QAAQ,IAAIF,EAAaE,QAAQ,GAAGvM,MAAgH,OAA1DkH,QAAQqD,MAAM,8BAA8B8B,GAAoB,GAAhHC,EAAaD,EAAaE,QAAQ,GAAGvM,KAEvU,GADAkH,QAAQC,IAAI,oBAAoBmF,GAC7BjB,GAAWmB,GAASA,EAAQgC,YAAYhC,EAAQgC,WAAW9E,OAAO,EAAE,CAACxC,QAAQC,IAAI,uBAAuBqF,EAAQgC,YACnH,MAAM7D,QAAkBnM,KAAK8H,iBAAiBkG,EAAQgC,YAAYtH,QAAQC,IAAI,0BAA0BwD,GACxG,MAAM8D,QAAoBjQ,KAAKgM,iBAAiB5E,EAAQ5F,EAAK2K,GAC7D,IAAI8B,EAAgB,GAAG,MAAMC,EAAe+B,EAAc9B,QAAQ,YAAY,IAAqB,IAAlBD,EAAoB,CAACD,EAAgBgC,EAAc7B,UAAUF,EAAe,GAAG,MAAMG,EAAYJ,EAAgBE,QAAQ,cAA+B,IAAfE,IAAkBJ,EAAgBA,EAAgBG,UAAU,EAAEC,QAAmB,CAC3S,MAAM6B,EAAcD,EAAc9B,QAAQ,WAAW,IAAoB,IAAjB+B,EAAmB,CAAC,MAAMC,EAAcF,EAAc9B,QAAQ,YACtHF,GADsJ,IAAjBkC,EACrHF,EAAc7B,UAAU+B,EAAc,GAAGhJ,OACzC8I,EAAc7B,UAAU8B,EAAc,GAAG/I,YACzD8G,EAAgBgC,EAC+H,OAA/IhC,EAAgBA,EAAgBnB,QAAQ,4BAA4B,IAAI3F,OAAOuB,QAAQC,IAAI,mCAAmCsF,GAAwBA,EACtJ,IAAIA,EAAgB,GAAG,MAAMC,EAAeJ,EAAaK,QAAQ,YAAY,IAAqB,IAAlBD,EAAoB,CAACD,EAAgBH,EAAaM,UAAUF,EAAe,GAE3J,MAAMG,EAAYJ,EAAgBE,QAAQ,cAA+B,IAAfE,IAAkBJ,EAAgBA,EAAgBG,UAAU,EAAEC,SACxHJ,EAAgBH,EACiC,OAAjDpF,QAAQC,IAAI,oBAAoBsF,GAAwBA,EAAiB,MAAMlC,GAAO,OAAGA,aAAiB7B,OAAoB,eAAb6B,EAAMxD,MACtHG,QAAQqD,MAAM,0BAA0BA,GADyG,KACrF7K,qBAAqB,GAAGlB,KAAKqB,cAAcrB,KAAKsB,qBAAoBtB,KAAKsB,mBAAmB8O,UAAUpQ,KAAKqB,aAAa+O,UAClLpQ,KAAKuB,MAAMC,MAAMxB,KAAKuB,MAAME,YAAW,CAAC,MAAM4O,EAAerQ,KAAKgG,aAAahG,KAAKuB,MAAMC,MAAMxB,KAAKsB,mBAAmBiC,MAAM+M,KAAK,GAAG1H,OAAOyH,EAAe,OAC/JnP,uBAAqD,OAA3BlB,KAAKuB,MAAMiB,eAAsB4D,OAAOY,aAAahH,KAAKuB,MAAMiB,gBAA+C,IAAI+N,EAAqB3D,OAAO9L,EAAsC,EAA9C,CAAiDG,GAElNN,EAAkBiC,EAAEH,OAAoBjC,EAAcoC,EAAEC,cAAcrC,EAAcoC,EAAE4N,WAAW,KAAkBhQ,EAAcoC,EAAEC,cAAc0N,EAAkB,OAAOrK,SAASuK,eAAe,UAI5LC,EACA,SAAUvQ,EAAQwQ,EAAStQ,GAEjCF,EAAOwQ,QAAUtQ,EAAoB,MAKnC,CAAC,CAAC,EAAE,EAAE"},"code":"(this.webpackJsonpstreamlit_copilot=this.webpackJsonpstreamlit_copilot||[]).push([[0],{14:function(e,t,o){\"use strict\";o.r(t);var s=o(1),n=o.n(s),r=o(5),i=o.n(r),a=o(0),l=o(2),c=o(3);const u=[\"prompt_template\",\"api_key\",\"height\",\"fontFamily\",\"border\",\"text\",\"question_title\"],p=[\"prompt_template\",\"api_url\",\"api_key\",\"height\",\"fontFamily\",\"border\",\"text\",\"question_title\"];class h extends c.b{constructor(){super(...arguments),this.userTextarea=null,this.suggestionTextarea=null,this.state={text:\"\",suggestion:\"\",isFocused:!1,textAreaIsFocused:!1,requestsThisMinute:0,currentMinute:Math.floor(Date.now()/6e4),totalRequests:0,successfulRequests:0,failedRequests:0,inputCost:0,outputCost:0,totalCost:0,debounceTimer:null},this.render=()=>{const{theme:e}=this.props;if(!e)return n.a.createElement(\"div\",null,\"Theme is undefined, please check streamlit version.\");const t=this.props.args.height,o=e.font,s=t+\"px\",r=\"1px solid \"+e.primaryColor,i=\"1px solid \"+e.secondaryBackgroundColor;return n.a.createElement(\"div\",null,n.a.createElement(\"div\",{style:{fontSize:\"1em\",color:e.textColor,marginBottom:\"0.5em\",padding:\"0.5em\",backgroundColor:e.backgroundColor,borderRadius:\"0.3em\",border:\"1px solid \"+e.secondaryBackgroundColor,display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\"}},n.a.createElement(\"div\",null,n.a.createElement(\"strong\",null,\"API Stats:\"),\" Total: \",this.state.totalRequests,\" | \\u2705 Success: \",this.state.successfulRequests,\" | \\u274c Failed: \",this.state.failedRequests,\" |\",\"Requests this per minute / limit: \",this.state.requestsThisMinute,\" / \",this.props.args.rpm_limit,n.a.createElement(\"br\",null),n.a.createElement(\"strong\",null,\"Cost:\"),\" Input: $\",this.state.inputCost.toFixed(6),\" | Output: $\",this.state.outputCost.toFixed(6),\" | Total: $\",this.state.totalCost.toFixed(6)),n.a.createElement(\"button\",{onClick:this.resetCounters,style:{fontSize:\"0.7em\",padding:\"0.2em 0.5em\",backgroundColor:e.primaryColor,color:\"white\",border:\"none\",borderRadius:\"0.3em\",cursor:\"pointer\"},title:\"Reset counters\"},\"\\ud83d\\udd04 Reset\")),n.a.createElement(\"div\",{tabIndex:0,style:{height:s,width:\"auto\",border:this.state.isFocused?r:i,borderRadius:\"0.5em\",overflowY:\"scroll\",overflowX:\"hidden\",position:\"relative\",backgroundColor:e.secondaryBackgroundColor},onFocus:this._onFocus,onBlur:this._onBlur},n.a.createElement(\"textarea\",{style:{marginLeft:\"0.5em\",fontFamily:o,marginTop:\"0.2em\",whiteSpace:\"pre-wrap\",width:\"calc(100% - 1.2em)\",height:\"100%\",border:\"none\",outline:\"none\",position:\"absolute\",backgroundColor:\"transparent\",color:\"light\"===e.base?\"rgba(41,51,62,0.5)\":\"rgba(255,255,255,0.5)\",padding:\"0\"},value:this.state.suggestion,readOnly:!0,ref:e=>{this.suggestionTextarea=e}}),n.a.createElement(\"textarea\",{style:{marginLeft:\"0.5em\",fontFamily:o,marginTop:\"0.2em\",whiteSpace:\"pre-wrap\",width:\"calc(100% - 1.2em)\",height:\"100%\",border:\"none\",outline:\"none\",position:\"absolute\",backgroundColor:\"transparent\",color:e.textColor,padding:\"0\"},value:this.state.text,onChange:this.onChange,onKeyDown:this.onKeyDown,onBlur:this._onTextAreaBlur,onScroll:this.onScroll,ref:e=>{this.userTextarea=e}})))},this.getTextWidth=e=>{if(!this.userTextarea)return 0;const t=document.createElement(\"span\");t.style.visibility=\"hidden\",t.style.position=\"absolute\",t.style.whiteSpace=\"pre-wrap\",t.style.fontFamily=window.getComputedStyle(this.userTextarea).fontFamily,t.style.fontSize=window.getComputedStyle(this.userTextarea).fontSize,t.textContent=e,document.body.appendChild(t);const o=t.offsetWidth;document.body.removeChild(t);return o+8},this.onScroll=()=>{this.forceUpdate()},this.onChange=e=>{const t=e.target.value;this.setState({text:t,suggestion:\"\"}),null!==this.state.debounceTimer&&window.clearTimeout(this.state.debounceTimer);const o=window.setTimeout(()=>{if(\"\"!==t.trim()){const e=this.props.args.api_url;this.callApi(t,e).then(e=>{\"\"!==this.state.text.trim()&&this.setState({suggestion:e},()=>{this.forceUpdate()})})}},500);this.setState({debounceTimer:o})},this.onKeyDown=e=>{\"Tab\"===e.key&&(e.preventDefault(),this.setState(e=>({text:e.suggestion,suggestion:\"\"}),()=>{const e={target:{value:this.state.text}};this.onChange(e)}))},this._onTextAreaBlur=()=>{this.setState({textAreaIsFocused:!1},()=>{c.a.setComponentValue(this.state.text),this.setState({suggestion:\"\"})})},this._onFocus=()=>{this.setState({isFocused:!0})},this._onBlur=()=>{this.setState({isFocused:!1})},this.resetCounters=()=>{this.setState({totalRequests:0,successfulRequests:0,failedRequests:0,requestsThisMinute:0,inputCost:0,outputCost:0,totalCost:0})},this.abortController=new AbortController,this.executeToolCalls=async e=>{const t=[];for(const n of e){var o,s;const e=null===(o=n.function)||void 0===o?void 0:o.name,r=JSON.parse((null===(s=n.function)||void 0===s?void 0:s.arguments)||\"{}\");if(console.log(\"Executing tool: \".concat(e,\" with args:\"),r),\"search_knowledge_base\"===e){const o=await this.executeTool(e,r),s=r.query||\"unknown query\",n='Search Query: \"'.concat(s,'\"\\n\\n').concat(o,\"\\n\\nSource: Information retrieved from Lysa's knowledge base via Pinecone vector search.\");t.push(n)}else t.push(\"Unknown tool: \".concat(e))}return t},this.executeTool=async(e,t)=>{if(\"search_knowledge_base\"===e){let e=\"\";e=\"string\"===typeof t.query?t.query:t.query&&\"object\"===typeof t.query?t.query.toString()||\"\":String(t.query||\"\"),console.log('Processing query: \"'.concat(e,'\"'));const s=this.props.args.pinecone_api_key,n=this.props.args.pinecone_index_name,r=this.props.args.openai_api_key;if(s&&n&&r)try{const t=await fetch(\"https://api.openai.com/v1/embeddings\",{method:\"POST\",headers:{Authorization:\"Bearer \".concat(r),\"Content-Type\":\"application/json\"},body:JSON.stringify({model:this.props.args.embedding_model||\"text-embedding-ada-002\",input:e})});if(!t.ok)throw new Error(\"OpenAI API error: \".concat(t.status));const o=(await t.json()).data[0].embedding,i=(this.props.args.pinecone_environment,this.props.args.pinecone_host||\"https://api.pinecone.io\");let a;a=i.includes(\"svc.\")&&i.includes(\".pinecone.io\")?\"https://\".concat(i,\"/query\"):\"\".concat(i,\"/indexes/\").concat(n,\"/query\"),console.log(\"Pinecone query URL: \".concat(a));const l=await fetch(a,{method:\"POST\",headers:{\"Api-Key\":s,\"Content-Type\":\"application/json\"},body:JSON.stringify({vector:o,topK:this.props.args.search_top||3,includeMetadata:!0})});if(!l.ok)throw new Error(\"Pinecone API error: \".concat(l.status));const c=await l.json();if(c.matches&&c.matches.length>0){const e=c.matches.map(e=>{var t,o,s,n;return{title:(null===(t=e.metadata)||void 0===t?void 0:t.title)||\"No title\",source:(null===(o=e.metadata)||void 0===o?void 0:o.source)||\"No source\",text:(null===(s=e.metadata)||void 0===s?void 0:s.text)||(null===(n=e.metadata)||void 0===n?void 0:n.content)||\"No content\"}}).filter(e=>\"No content\"!==e.text);if(e.length>0)return console.log(\"Found results:\",e),JSON.stringify({count:e.length,results:e},null,2)}return\"\"}catch(o){return console.error(\"Pinecone search error:\",o),\"\"}return\"\"}return\"\"},this.makeFollowUpCall=async(e,t,o)=>{const s=\"Based on the following search results from Lysa's knowledge base, please provide a helpful response to the customer question.\\n\\nSearch Results:\\n\".concat(o.join(\"\\n\\n\"),'\\n\\nCustomer Question: \"').concat(t,'\"\\n\\nPlease provide a comprehensive answer based on the search results above. Include source references where appropriate.'),n=this.props.args,{prompt_template:r,api_key:i,height:c,fontFamily:p,border:h,text:d,question_title:m}=n,g=Object(l.a)(n,u),f=(r.replace(\"{text}\",d||\"\").replace(\"{question_title}\",m||\"\"),\"chat\"===this.props.args.api_format||e.includes(\"/chat/completions\")),b=new AbortController;let y;if(f){const e={};g.model&&(e.model=g.model),g.max_tokens&&(e.max_tokens=g.max_tokens),g.temperature&&(e.temperature=g.temperature),g.top_p&&(e.top_p=g.top_p),g.stop&&(e.stop=g.stop),y=Object(a.a)(Object(a.a)({messages:[{role:\"user\",content:s}]},e),{},{stream:!1})}else y=Object(a.a)(Object(a.a)({prompt:s},g),{},{echo:!1});const x={\"Content-Type\":\"application/json\"};i&&(x.Authorization=\"Bearer \".concat(i));try{const t=await fetch(e,{method:\"POST\",headers:x,body:JSON.stringify(y),signal:b.signal});if(!t.ok)throw new Error(\"HTTP error! status: \".concat(t.status));const o=await t.json();let s=\"\";if(f&&o.choices&&o.choices[0]&&o.choices[0].message)s=o.choices[0].message.content;else{if(!(o.choices&&o.choices[0]&&o.choices[0].text))return console.error(\"Unexpected response format:\",o),\"\";s=o.choices[0].text}let n=\"\";const r=s.indexOf(\"<answer>\");if(-1!==r){n=s.substring(r+8);const e=n.indexOf(\"</answer>\");-1!==e&&(n=n.substring(0,e))}else n=s;return n}catch(w){return console.error(\"Follow-up call error:\",w),\"\"}},this.callApi=async(e,t)=>{if(this.abortController.abort(),this.abortController=new AbortController,\"\"===e.trim())return\"\";const o=Math.floor(Date.now()/6e4);if(o>this.state.currentMinute)this.setState({currentMinute:o,requestsThisMinute:0});else if(this.state.requestsThisMinute>this.props.args.rpm_limit)return new Promise(o=>{setTimeout(()=>{o(this.callApi(e,t))},1e3)});const s=this.props.args,{prompt_template:n,api_url:r,api_key:i,height:c,fontFamily:u,border:h,text:d,question_title:m}=s,g=Object(l.a)(s,p),f=n.replace(\"{text}\",d||\"\").replace(\"{question_title}\",m||\"\"),b=\"chat\"===this.props.args.api_format||t.includes(\"/chat/completions\"),y=[{type:\"function\",function:{name:\"search_knowledge_base\",description:\"S\\xf6k i Lysas kunskapsbas efter information f\\xf6r kundsupport\",parameters:{type:\"object\",properties:{query:{type:\"string\",description:\"S\\xf6kfr\\xe5ga f\\xf6r att hitta relevant information\"}},required:[\"query\"]}}}];let x;if(b){const e={};g.model&&(e.model=g.model),g.max_tokens&&(e.max_tokens=g.max_tokens),g.temperature&&(e.temperature=g.temperature),g.top_p&&(e.top_p=g.top_p),g.stop&&(e.stop=g.stop),x=Object(a.a)(Object(a.a)({messages:[{role:\"user\",content:f}]},e),{},{tools:y,tool_choice:\"auto\",stream:!1})}else x=Object(a.a)(Object(a.a)({prompt:f},g),{},{echo:!1});const w={\"Content-Type\":\"application/json\"};i&&(w.Authorization=\"Bearer \".concat(i));try{var _,C;this.setState(e=>({totalRequests:e.totalRequests+1}));const o=await fetch(t,{method:\"POST\",headers:w,body:JSON.stringify(x),signal:this.abortController.signal});if(!o.ok){const e=await o.text();throw console.error(\"API Error Response:\",e),this.setState(e=>({failedRequests:e.failedRequests+1})),new Error(\"HTTP error! status: \".concat(o.status))}this.setState(e=>({requestsThisMinute:e.requestsThisMinute+1,successfulRequests:e.successfulRequests+1}));const s=await o.json(),n=(null===(_=s.usage)||void 0===_?void 0:_.prompt_tokens)||0,r=(null===(C=s.usage)||void 0===C?void 0:C.completion_tokens)||0,i=this.props.args.token_cost||.05,a=this.props.args.output_token_cost||.1,l=n||Math.ceil(f.length/4),c=l/1e6*i,u=(r||0)/1e6*a;this.setState(e=>({inputCost:e.inputCost+c,outputCost:e.outputCost+u,totalCost:e.totalCost+c+u}));let p=\"\",h=null;if(b&&s.choices&&s.choices[0]&&s.choices[0].message)h=s.choices[0].message,p=h.content||\"\";else{if(!(s.choices&&s.choices[0]&&s.choices[0].text))return console.error(\"Unexpected response format:\",s),\"\";p=s.choices[0].text}if(console.log(\"Full AI Response:\",p),b&&h&&h.tool_calls&&h.tool_calls.length>0){console.log(\"Tool calls detected:\",h.tool_calls);const o=await this.executeToolCalls(h.tool_calls);console.log(\"Tool execution results:\",o);const s=await this.makeFollowUpCall(t,e,o);let n=\"\";const r=s.indexOf(\"<answer>\");if(-1!==r){n=s.substring(r+8);const e=n.indexOf(\"</answer>\");-1!==e&&(n=n.substring(0,e))}else{const e=s.indexOf(\"<think>\");if(-1!==e){const t=s.indexOf(\"</think>\");n=-1!==t?s.substring(t+8).trim():s.substring(e+7).trim()}else n=s}return n=n.replace(/<think>[\\s\\S]*?<\\/think>/g,\"\").trim(),console.log(\"Extracted Answer from follow-up:\",n),n}let d=\"\";const m=p.indexOf(\"<answer>\");if(-1!==m){d=p.substring(m+8);const e=d.indexOf(\"</answer>\");-1!==e&&(d=d.substring(0,e))}else d=p;return console.log(\"Extracted Answer:\",d),d}catch(T){return T instanceof Error&&\"AbortError\"===T.name||console.error(\"Error decoding response\",T),\"\"}}}componentDidUpdate(){if(this.userTextarea&&this.suggestionTextarea&&(this.suggestionTextarea.scrollTop=this.userTextarea.scrollTop,this.state.text&&this.state.suggestion)){const e=this.getTextWidth(this.state.text);this.suggestionTextarea.style.left=\"\".concat(e,\"px\")}}componentWillUnmount(){null!==this.state.debounceTimer&&window.clearTimeout(this.state.debounceTimer)}}var d=Object(c.c)(h);i.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(d,null)),document.getElementById(\"root\"))},7:function(e,t,o){e.exports=o(14)}},[[7,1,2]]]);","extractedComments":[]}