{"map":{"version":3,"sources":["static/js/main.e0ff1743.chunk.js"],"names":["this","push","12","module","__webpack_exports__","__webpack_require__","r","react","react_default","n","react_dom","react_dom_default","dist","streamlit_copilot_Copilot","[object Object]","super","arguments","userTextarea","suggestionTextarea","state","text","suggestion","isFocused","textAreaIsFocused","requestsThisMinute","currentMinute","Math","floor","Date","now","totalRequests","successfulRequests","failedRequests","inputCost","outputCost","totalCost","debounceTimer","render","theme","props","a","createElement","height_int","args","font_fam","font","f_height","f_focused","primaryColor","f_not_focused","secondaryBackgroundColor","style","fontSize","color","textColor","marginBottom","padding","backgroundColor","borderRadius","border","display","justifyContent","alignItems","toFixed","onClick","resetCounters","cursor","title","tabIndex","height","width","overflowY","overflowX","position","onFocus","_onFocus","onBlur","_onBlur","marginLeft","fontFamily","marginTop","whiteSpace","outline","base","value","readOnly","ref","textarea","onChange","onKeyDown","_onTextAreaBlur","onScroll","forceUpdate","event","target","setState","window","clearTimeout","timer","setTimeout","trim","api_upl","callApi","then","key","preventDefault","prevState","syntheticEvent","setComponentValue","executeToolCalls","async","results","toolCall","toolCalls","_toolCall$function","_toolCall$function2","functionName","function","name","JSON","parse","result","simulateVectorSearch","query","console","log","concat","Promise","resolve","makeFollowUpCall","apiUrl","userInput","toolResults","followUpPrompt","join","api_key","model_kwargs","payload","messages","role","content","model","max_tokens","temperature","stream","headers","Content-Type","response","fetch","method","body","stringify","ok","Error","status","json","choices","message","error","abortController","AbortController","abort","prompt_template","api_url","questionText","question_title","prompt","replace","isChatApi","includes","validParams","top_p","stop","tools","type","description","parameters","properties","required","tool_choice","echo","_responseJson$usage","_responseJson$usage2","signal","errorText","responseJson","inputTokens","usage","prompt_tokens","outputTokens","completion_tokens","inputPrice","outputPrice","estimatedInputTokens","ceil","length","newInputCost","newOutputCost","fullResponse","tool_calls","finalResponse","extractedAnswer","answerTagIndex","indexOf","substring","endTagIndex","scrollTop","streamlit_copilot","Object","StrictMode","document","getElementById","5","exports"],"mappings":"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"},"code":"(this.webpackJsonpstreamlit_copilot=this.webpackJsonpstreamlit_copilot||[]).push([[0],{12:function(t,e,s){\"use strict\";s.r(e);var o=s(0),r=s.n(o),n=s(3),a=s.n(n),i=s(1);class l extends i.b{constructor(){super(...arguments),this.userTextarea=null,this.suggestionTextarea=null,this.state={text:\"\",suggestion:\"\",isFocused:!1,textAreaIsFocused:!1,requestsThisMinute:0,currentMinute:Math.floor(Date.now()/6e4),totalRequests:0,successfulRequests:0,failedRequests:0,inputCost:0,outputCost:0,totalCost:0,debounceTimer:null},this.render=()=>{const{theme:t}=this.props;if(!t)return r.a.createElement(\"div\",null,\"Theme is undefined, please check streamlit version.\");const e=this.props.args.height,s=t.font,o=e+\"px\",n=\"1px solid \"+t.primaryColor,a=\"1px solid \"+t.secondaryBackgroundColor;return r.a.createElement(\"div\",null,r.a.createElement(\"div\",{style:{fontSize:\"1em\",color:t.textColor,marginBottom:\"0.5em\",padding:\"0.5em\",backgroundColor:t.backgroundColor,borderRadius:\"0.3em\",border:\"1px solid \"+t.secondaryBackgroundColor,display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\"}},r.a.createElement(\"div\",null,r.a.createElement(\"strong\",null,\"API Stats:\"),\" Total: \",this.state.totalRequests,\" | \\u2705 Success: \",this.state.successfulRequests,\" | \\u274c Failed: \",this.state.failedRequests,\" |\",\"Requests this per minute / limit: \",this.state.requestsThisMinute,\" / \",this.props.args.rpm_limit,r.a.createElement(\"br\",null),r.a.createElement(\"strong\",null,\"Cost:\"),\" Input: $\",this.state.inputCost.toFixed(6),\" | Output: $\",this.state.outputCost.toFixed(6),\" | Total: $\",this.state.totalCost.toFixed(6)),r.a.createElement(\"button\",{onClick:this.resetCounters,style:{fontSize:\"0.7em\",padding:\"0.2em 0.5em\",backgroundColor:t.primaryColor,color:\"white\",border:\"none\",borderRadius:\"0.3em\",cursor:\"pointer\"},title:\"Reset counters\"},\"\\ud83d\\udd04 Reset\")),r.a.createElement(\"div\",{tabIndex:0,style:{height:o,width:\"auto\",border:this.state.isFocused?n:a,borderRadius:\"0.5em\",overflowY:\"scroll\",overflowX:\"hidden\",position:\"relative\",backgroundColor:t.secondaryBackgroundColor},onFocus:this._onFocus,onBlur:this._onBlur},r.a.createElement(\"textarea\",{style:{marginLeft:\"0.5em\",fontFamily:s,marginTop:\"0.2em\",whiteSpace:\"pre-wrap\",width:\"calc(100% - 1.2em)\",height:\"100%\",border:\"none\",outline:\"none\",position:\"absolute\",backgroundColor:\"transparent\",color:\"light\"===t.base?\"rgba(41,51,62,0.5)\":\"rgba(255,255,255,0.5)\",padding:\"0\"},value:this.state.suggestion,readOnly:!0,ref:t=>{this.suggestionTextarea=t}}),r.a.createElement(\"textarea\",{style:{marginLeft:\"0.5em\",fontFamily:s,marginTop:\"0.2em\",whiteSpace:\"pre-wrap\",width:\"calc(100% - 1.2em)\",height:\"100%\",border:\"none\",outline:\"none\",position:\"absolute\",backgroundColor:\"transparent\",color:t.textColor,padding:\"0\"},value:this.state.text,onChange:this.onChange,onKeyDown:this.onKeyDown,onBlur:this._onTextAreaBlur,onScroll:this.onScroll,ref:t=>{this.userTextarea=t}})))},this.onScroll=()=>{this.forceUpdate()},this.onChange=t=>{const e=t.target.value;this.setState({text:e,suggestion:\"\"}),null!==this.state.debounceTimer&&window.clearTimeout(this.state.debounceTimer);const s=window.setTimeout(()=>{if(\"\"!==e.trim()){const t=this.props.args.api_url;this.callApi(e,t).then(t=>{\"\"!==this.state.text.trim()&&this.setState({suggestion:this.state.text+t})})}},500);this.setState({debounceTimer:s})},this.onKeyDown=t=>{\"Tab\"===t.key&&(t.preventDefault(),this.setState(t=>({text:t.suggestion,suggestion:\"\"}),()=>{const t={target:{value:this.state.text}};this.onChange(t)}))},this._onTextAreaBlur=()=>{this.setState({textAreaIsFocused:!1},()=>{i.a.setComponentValue(this.state.text),this.setState({suggestion:\"\"})})},this._onFocus=()=>{this.setState({isFocused:!0})},this._onBlur=()=>{this.setState({isFocused:!1})},this.resetCounters=()=>{this.setState({totalRequests:0,successfulRequests:0,failedRequests:0,requestsThisMinute:0,inputCost:0,outputCost:0,totalCost:0})},this.executeToolCalls=async t=>{const e=[];for(const r of t){var s,o;const t=null===(s=r.function)||void 0===s?void 0:s.name,n=JSON.parse(null===(o=r.function)||void 0===o?void 0:o.arguments);if(\"search_knowledge_base\"===t){const t=await this.simulateVectorSearch(n.query);e.push(t)}}return e},this.simulateVectorSearch=async t=>(console.log(\"Simulating vector search for query: \".concat(t)),await new Promise(t=>setTimeout(t,100)),'Search results for \"'.concat(t,'\": Based on our knowledge base, this appears to be related to customer fees, investment options, or account management.')),this.makeFollowUpCall=async(t,e,s)=>{const o=\"Based on search results: \".concat(s.join(\"\\n\"),'\\n\\nComplete: \"').concat(e,'\"'),{api_key:r,...n}=this.props.args,a={messages:[{role:\"user\",content:o}],model:n.model||\"gpt-3.5-turbo\",max_tokens:n.max_tokens||100,temperature:n.temperature||.7,stream:!1},i={\"Content-Type\":\"application/json\"};r&&(i.Authorization=\"Bearer \".concat(r));try{const e=await fetch(t,{method:\"POST\",headers:i,body:JSON.stringify(a)});if(!e.ok)throw new Error(\"HTTP error! status: \".concat(e.status));return(await e.json()).choices[0].message.content}catch(l){return console.error(\"Error in follow-up call:\",l),\"\"}},this.abortController=new AbortController,this.callApi=async(t,e)=>{if(this.abortController.abort(),this.abortController=new AbortController,\"\"===t.trim())return\"\";const s=Math.floor(Date.now()/6e4);if(s>this.state.currentMinute)this.setState({currentMinute:s,requestsThisMinute:0});else if(this.state.requestsThisMinute>this.props.args.rpm_limit)return new Promise(s=>{setTimeout(()=>{s(this.callApi(t,e))},1e3)});const{prompt_template:o,api_url:r,api_key:n,height:a,fontFamily:i,border:l,text:c,question_title:u,...h}=this.props.args,p=o.replace(\"{text}\",c||\"\").replace(\"{question_title}\",u||\"\"),d=\"chat\"===this.props.args.api_format||e.includes(\"/chat/completions\");let m;if(d){const t={};h.model&&(t.model=h.model),h.max_tokens&&(t.max_tokens=h.max_tokens),h.temperature&&(t.temperature=h.temperature),h.top_p&&(t.top_p=h.top_p),h.stop&&(t.stop=h.stop);const e=[{type:\"function\",function:{name:\"search_knowledge_base\",description:\"Search the vector database for customer information and support content\",parameters:{type:\"object\",properties:{query:{type:\"string\",description:\"Search query to find relevant information\"}},required:[\"query\"]}}}];m={messages:[{role:\"user\",content:p}],...t,tools:e,tool_choice:\"auto\",stream:!1}}else m={prompt:p,...h,echo:!1};const g={\"Content-Type\":\"application/json\"};n&&(g.Authorization=\"Bearer \".concat(n));try{var f,b;this.setState(t=>({totalRequests:t.totalRequests+1}));const s=await fetch(e,{method:\"POST\",headers:g,body:JSON.stringify(m),signal:this.abortController.signal});if(!s.ok){const t=await s.text();throw console.error(\"API Error Response:\",t),this.setState(t=>({failedRequests:t.failedRequests+1})),new Error(\"HTTP error! status: \".concat(s.status))}this.setState(t=>({requestsThisMinute:t.requestsThisMinute+1,successfulRequests:t.successfulRequests+1}));const o=await s.json(),r=(null===(f=o.usage)||void 0===f?void 0:f.prompt_tokens)||0,n=(null===(b=o.usage)||void 0===b?void 0:b.completion_tokens)||0,a=this.props.args.token_cost||.05,i=this.props.args.output_token_cost||.1,l=r||Math.ceil(p.length/4),c=l/1e6*a,u=(n||0)/1e6*i;this.setState(t=>({inputCost:t.inputCost+c,outputCost:t.outputCost+u,totalCost:t.totalCost+c+u}));let h=\"\",x=null;if(d&&o.choices&&o.choices[0]&&o.choices[0].message)x=o.choices[0].message,h=x.content||\"\";else{if(!(o.choices&&o.choices[0]&&o.choices[0].text))return console.error(\"Unexpected response format:\",o),\"\";h=o.choices[0].text}if(d&&x&&x.tool_calls&&x.tool_calls.length>0){console.log(\"Tool calls detected:\",x.tool_calls);const s=await this.executeToolCalls(x.tool_calls),o=await this.makeFollowUpCall(e,t,s);if(o)return o}console.log(\"Full AI Response:\",h);let C=\"\";const w=h.indexOf(\"<answer>\");if(-1!==w){C=h.substring(w+8);const t=C.indexOf(\"</answer>\");-1!==t&&(C=C.substring(0,t))}else C=h;return console.log(\"Extracted Answer:\",C),C}catch(x){return x instanceof Error&&\"AbortError\"===x.name||console.error(\"Error decoding response\",x),\"\"}}}componentDidUpdate(){this.userTextarea&&this.suggestionTextarea&&(this.suggestionTextarea.scrollTop=this.userTextarea.scrollTop)}componentWillUnmount(){null!==this.state.debounceTimer&&window.clearTimeout(this.state.debounceTimer)}}var c=Object(i.c)(l);a.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(c,null)),document.getElementById(\"root\"))},5:function(t,e,s){t.exports=s(12)}},[[5,1,2]]]);","extractedComments":[]}