{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AssistantHostSingleton = void 0;\nconst utils_1 = require(\"../utils\");\nconst asstControlOperationsBuilder_1 = require(\"./control/asstControlOperationsBuilder\");\nconst control_1 = require(\"./control\");\nexports.AssistantHostSingleton = function () {\n  const hostUrls = {}; // map of apiKey-assistantName to hostUrl\n  function ensureAssistantPath(url) {\n    if (!url.endsWith('/assistant')) {\n      // Append \"/assistant\" if it doesn't already end with it\n      url = url.endsWith('/') ? \"\".concat(url, \"assistant\") : \"\".concat(url, \"/assistant\");\n    }\n    return url;\n  }\n  const _describeAssistant = async (config, assistantName) => {\n    const assistantControlApi = (0, asstControlOperationsBuilder_1.asstControlOperationsBuilder)(config);\n    const describeResponse = await (0, control_1.describeAssistant)(assistantControlApi)(assistantName);\n    const host = describeResponse === null || describeResponse === void 0 ? void 0 : describeResponse.host;\n    if (!host) {\n      // if the host is empty for some reason, default based on region\n      let defaultHost = 'https://prod-1-data.ke.pinecone.io';\n      // If 'eu' is specified use that, otherwise default to 'us'\n      if (config.assistantRegion && config.assistantRegion.toLowerCase() === 'eu') {\n        defaultHost = 'https://prod-eu-data.ke.pinecone.io';\n      }\n      return defaultHost;\n    } else {\n      return host;\n    }\n  };\n  const _key = (config, assistantName) => \"\".concat(config.apiKey, \"-\").concat(assistantName);\n  // singleton object\n  const singleton = {\n    getHostUrl: async (config, assistantName) => {\n      const cacheKey = _key(config, assistantName);\n      if (cacheKey in hostUrls) {\n        return hostUrls[cacheKey];\n      } else {\n        const hostUrl = await _describeAssistant(config, assistantName);\n        hostUrls[cacheKey] = (0, utils_1.normalizeUrl)(ensureAssistantPath(hostUrl));\n      }\n      return hostUrls[cacheKey];\n    },\n    _reset: () => {\n      for (const key of Object.keys(hostUrls)) {\n        delete hostUrls[key];\n      }\n    },\n    _set: (config, assistantName, hostUrl) => {\n      const normalizedHostUrl = (0, utils_1.normalizeUrl)(ensureAssistantPath(hostUrl));\n      // prevent adding an empty hostUrl to the cache\n      if (!hostUrl || !normalizedHostUrl) {\n        return;\n      }\n      const cacheKey = _key(config, assistantName);\n      hostUrls[cacheKey] = normalizedHostUrl;\n    },\n    _delete: (config, assistantName) => {\n      const cacheKey = _key(config, assistantName);\n      delete hostUrls[cacheKey];\n    }\n  };\n  return singleton;\n}();","map":{"version":3,"mappings":";;;;;;AACA;AACA;AACA;AAEaA,8BAAsB,GAAI;EACrC,MAAMC,QAAQ,GAAG,EAAE,CAAC,CAAC;EAErB,SAASC,mBAAmB,CAACC,GAAG;IAC9B,IAAI,CAACA,GAAG,CAACC,QAAQ,CAAC,YAAY,CAAC,EAAE;MAC/B;MACAD,GAAG,GAAGA,GAAG,CAACC,QAAQ,CAAC,GAAG,CAAC,aAAMD,GAAG,2BAAiBA,GAAG,eAAY;;IAElE,OAAOA,GAAG;EACZ;EAEA,MAAME,kBAAkB,GAAG,OACzBC,MAA6B,EAC7BC,aAAqB,KACF;IACnB,MAAMC,mBAAmB,GAAG,+DAA4B,EAACF,MAAM,CAAC;IAChE,MAAMG,gBAAgB,GAAG,MAAM,+BAAiB,EAACD,mBAAmB,CAAC,CACnED,aAAa,CACd;IACD,MAAMG,IAAI,GAAGD,gBAAgB,aAAhBA,gBAAgB,uBAAhBA,gBAAgB,CAAEC,IAAI;IAEnC,IAAI,CAACA,IAAI,EAAE;MACT;MACA,IAAIC,WAAW,GAAG,oCAAoC;MACtD;MACA,IACEL,MAAM,CAACM,eAAe,IACtBN,MAAM,CAACM,eAAe,CAACC,WAAW,EAAE,KAAK,IAAI,EAC7C;QACAF,WAAW,GAAG,qCAAqC;;MAErD,OAAOA,WAAW;KACnB,MAAM;MACL,OAAOD,IAAI;;EAEf,CAAC;EAED,MAAMI,IAAI,GAAG,CAACR,MAA6B,EAAEC,aAAqB,eAC7DD,MAAM,CAACS,MAAM,cAAIR,aAAa,CAAE;EAErC;EACA,MAAMS,SAAS,GAAG;IAChBC,UAAU,EAAE,OACVX,MAA6B,EAC7BC,aAAqB,KACnB;MACF,MAAMW,QAAQ,GAAGJ,IAAI,CAACR,MAAM,EAAEC,aAAa,CAAC;MAC5C,IAAIW,QAAQ,IAAIjB,QAAQ,EAAE;QACxB,OAAOA,QAAQ,CAACiB,QAAQ,CAAC;OAC1B,MAAM;QACL,MAAMC,OAAO,GAAG,MAAMd,kBAAkB,CAACC,MAAM,EAAEC,aAAa,CAAC;QAC/DN,QAAQ,CAACiB,QAAQ,CAAC,GAAG,wBAAY,EAAChB,mBAAmB,CAACiB,OAAO,CAAC,CAAC;;MAEjE,OAAOlB,QAAQ,CAACiB,QAAQ,CAAC;IAC3B,CAAC;IAEDE,MAAM,EAAE,MAAK;MACX,KAAK,MAAMC,GAAG,IAAIC,MAAM,CAACC,IAAI,CAACtB,QAAQ,CAAC,EAAE;QACvC,OAAOA,QAAQ,CAACoB,GAAG,CAAC;;IAExB,CAAC;IAEDG,IAAI,EAAE,CACJlB,MAA6B,EAC7BC,aAAqB,EACrBY,OAAe,KACb;MACF,MAAMM,iBAAiB,GAAG,wBAAY,EAACvB,mBAAmB,CAACiB,OAAO,CAAC,CAAC;MACpE;MACA,IAAI,CAACA,OAAO,IAAI,CAACM,iBAAiB,EAAE;QAClC;;MAGF,MAAMP,QAAQ,GAAGJ,IAAI,CAACR,MAAM,EAAEC,aAAa,CAAC;MAC5CN,QAAQ,CAACiB,QAAQ,CAAC,GAAGO,iBAAiB;IACxC,CAAC;IAEDC,OAAO,EAAE,CAACpB,MAA6B,EAAEC,aAAqB,KAAI;MAChE,MAAMW,QAAQ,GAAGJ,IAAI,CAACR,MAAM,EAAEC,aAAa,CAAC;MAC5C,OAAON,QAAQ,CAACiB,QAAQ,CAAC;IAC3B;GACD;EAED,OAAOF,SAAS;AAClB,CAAC,EAAG","names":["exports","hostUrls","ensureAssistantPath","url","endsWith","_describeAssistant","config","assistantName","assistantControlApi","describeResponse","host","defaultHost","assistantRegion","toLowerCase","_key","apiKey","singleton","getHostUrl","cacheKey","hostUrl","_reset","key","Object","keys","_set","normalizedHostUrl","_delete"],"sourceRoot":"","sources":["../../src/assistant/assistantHostSingleton.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}