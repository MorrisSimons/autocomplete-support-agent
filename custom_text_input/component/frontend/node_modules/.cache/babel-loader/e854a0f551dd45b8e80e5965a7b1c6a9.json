{"ast":null,"code":"import{StreamlitComponentBase,withStreamlitConnection,Streamlit}from\"streamlit-component-lib\";import React from\"react\";class Copilot extends StreamlitComponentBase{constructor(){super(...arguments);this.userTextarea=null;this.suggestionTextarea=null;this.state={\"text\":\"\",\"suggestion\":\"\",\"isFocused\":false,'textAreaIsFocused':false,requestsThisMinute:0,currentMinute:Math.floor(Date.now()/60000)};this.render=()=>{const{theme}=this.props;if(!theme){return/*#__PURE__*/React.createElement(\"div\",null,\"Theme is undefined, please check streamlit version.\");}const height_int=this.props.args[\"height\"];const font_fam=theme.font;const f_height=height_int+'px';const f_focused='1px solid '+theme.primaryColor;const f_not_focused='1px solid '+theme.secondaryBackgroundColor;return/*#__PURE__*/React.createElement(\"div\",{tabIndex:0,style:{height:f_height,width:'auto',border:this.state.isFocused?f_focused:f_not_focused,borderRadius:'0.5em',overflowY:'scroll',overflowX:'hidden',position:'relative',backgroundColor:theme.secondaryBackgroundColor},onFocus:this._onFocus,onBlur:this._onBlur},/*#__PURE__*/React.createElement(\"textarea\",{style:{marginLeft:'0.5em',fontFamily:font_fam,marginTop:'0.2em',whiteSpace:'pre-wrap',width:'calc(100% - 1.2em)',height:'100%',border:'none',outline:'none',position:'absolute',backgroundColor:'transparent',color:theme.base==='light'?'rgba(41,51,62,0.5)':'rgba(255,255,255,0.5)',padding:'0'},value:this.state.suggestion,readOnly:true,ref:textarea=>{this.suggestionTextarea=textarea;}}),/*#__PURE__*/React.createElement(\"textarea\",{style:{marginLeft:'0.5em',fontFamily:font_fam,marginTop:'0.2em',whiteSpace:'pre-wrap',width:'calc(100% - 1.2em)',height:'100%',border:'none',outline:'none',position:'absolute',backgroundColor:'transparent',color:theme.textColor,padding:'0'},value:this.state.text,onChange:this.onChange,onKeyDown:this.onKeyDown,onBlur:this._onTextAreaBlur,onScroll:this.onScroll,ref:textarea=>{this.userTextarea=textarea;}}));};this.onScroll=()=>{this.forceUpdate();};this.onChange=event=>{const text=event.target.value;const api_upl=this.props.args[\"api_url\"];this.setState({text,suggestion:\"\"},()=>{if(text.trim()!==\"\"){this.callApi(text,api_upl).then(suggestion=>{if(this.state.text.trim()!==\"\"){this.setState({suggestion:this.state.text+suggestion});}});}});};this.onKeyDown=event=>{if(event.key==='Enter'){event.preventDefault();this.setState(prevState=>({text:prevState.suggestion,suggestion:''}),()=>{// Create a synthetic event and call onChange manually\nconst syntheticEvent={target:{value:this.state.text}};this.onChange(syntheticEvent);});}};this._onTextAreaBlur=()=>{this.setState({textAreaIsFocused:false},()=>{Streamlit.setComponentValue(this.state.text);this.setState({suggestion:''});});};this._onFocus=()=>{this.setState({isFocused:true});};this._onBlur=()=>{this.setState({isFocused:false});};this.abortController=new AbortController();this.callApi=async(text,api_upl)=>{// Abort the previous request\nthis.abortController.abort();this.abortController=new AbortController();if(text.trim()===\"\"){return\"\";}const currentMinute=Math.floor(Date.now()/60000);if(currentMinute>this.state.currentMinute){this.setState({currentMinute:currentMinute,requestsThisMinute:0});}else if(this.state.requestsThisMinute>this.props.args[\"rpm_limit\"]){// Retry after 1 second if limit is exceeded\nreturn new Promise(resolve=>{setTimeout(()=>{resolve(this.callApi(text,api_upl));},1000);});}const{prompt_template,api_url,api_key,height,fontFamily,border,...model_kwargs}=this.props.args;const prompt=prompt_template.replace(\"{text}\",text);// format the prompt\n// Check if this is a Groq API call (chat completions format)\nconst isGroq=api_upl.includes('groq.com')||api_upl.includes('openai/v1/chat/completions');let payload;if(isGroq){// Use chat completions format for Groq - only include valid parameters\nconst validParams={};if(model_kwargs.model)validParams.model=model_kwargs.model;if(model_kwargs.max_tokens)validParams.max_tokens=model_kwargs.max_tokens;if(model_kwargs.temperature)validParams.temperature=model_kwargs.temperature;if(model_kwargs.top_p)validParams.top_p=model_kwargs.top_p;if(model_kwargs.stop)validParams.stop=model_kwargs.stop;payload={messages:[{role:\"user\",content:prompt}],...validParams,stream:false};}else{// Use legacy completions format for other APIs\npayload={prompt:prompt,...model_kwargs,echo:false};}const headers={'Content-Type':'application/json'};// Add API key if provided\nif(api_key){headers['Authorization']=\"Bearer \".concat(api_key);}try{const response=await fetch(api_upl,{method:\"POST\",headers:headers,body:JSON.stringify(payload),signal:this.abortController.signal});if(!response.ok){const errorText=await response.text();console.error(\"API Error Response:\",errorText);throw new Error(\"HTTP error! status: \".concat(response.status));}this.setState(prevState=>({requestsThisMinute:prevState.requestsThisMinute+1}));const responseJson=await response.json();// Handle both chat completions and legacy completions formats\nif(isGroq&&responseJson.choices&&responseJson.choices[0]&&responseJson.choices[0].message){return responseJson.choices[0].message.content;}else if(responseJson.choices&&responseJson.choices[0]&&responseJson.choices[0].text){return responseJson.choices[0].text;}else{console.error(\"Unexpected response format:\",responseJson);return\"\";}}catch(error){if(error.name==='AbortError'){return\"\";// Return empty string if request was aborted\n}console.error(\"Error decoding response\",error);return\"\";}};}componentDidUpdate(){if(this.userTextarea&&this.suggestionTextarea){this.suggestionTextarea.scrollTop=this.userTextarea.scrollTop;}}}export default withStreamlitConnection(Copilot);","map":{"version":3,"names":["StreamlitComponentBase","withStreamlitConnection","Streamlit","React","Copilot","userTextarea","suggestionTextarea","state","requestsThisMinute","currentMinute","Math","floor","Date","now","render","theme","props","height_int","args","font_fam","font","f_height","f_focused","primaryColor","f_not_focused","secondaryBackgroundColor","height","width","border","isFocused","borderRadius","overflowY","overflowX","position","backgroundColor","_onFocus","_onBlur","marginLeft","fontFamily","marginTop","whiteSpace","outline","color","base","padding","suggestion","textarea","textColor","text","onChange","onKeyDown","_onTextAreaBlur","onScroll","forceUpdate","event","target","value","api_upl","setState","trim","callApi","then","key","preventDefault","prevState","syntheticEvent","textAreaIsFocused","setComponentValue","abortController","AbortController","abort","Promise","resolve","setTimeout","prompt_template","api_url","api_key","model_kwargs","prompt","replace","isGroq","includes","payload","validParams","model","max_tokens","temperature","top_p","stop","messages","role","content","stream","echo","headers","response","fetch","method","body","JSON","stringify","signal","ok","errorText","console","error","Error","status","responseJson","json","choices","message","name","componentDidUpdate","scrollTop"],"sources":["/home/morrissimons/Desktop/lysa-support-agent/custom_text_input/component/frontend/src/streamlit_copilot.tsx"],"sourcesContent":["import {\n  StreamlitComponentBase,\n  withStreamlitConnection,\n  Streamlit,\n} from \"streamlit-component-lib\"\nimport React, { ReactNode } from \"react\"\n\ninterface State {\n  text: string\n  suggestion: string\n  isFocused: boolean\n  textAreaIsFocused: boolean\n  requestsThisMinute: number\n  currentMinute: number\n}\n\nclass Copilot extends StreamlitComponentBase<State> {\n\n  private userTextarea: HTMLTextAreaElement | null = null;\n  private suggestionTextarea: HTMLTextAreaElement | null = null;\n  public state = {\n    \"text\": \"\",\n    \"suggestion\": \"\",\n    \"isFocused\": false,\n    'textAreaIsFocused': false,\n    requestsThisMinute: 0,\n    currentMinute: Math.floor(Date.now() / 60000)\n  }\n\n  public render = (): ReactNode => {\n    const { theme } = this.props\n    if (!theme) {\n      return <div>Theme is undefined, please check streamlit version.</div>\n    }\n    const height_int = this.props.args[\"height\"]\n    const font_fam = theme.font;\n\n    const f_height = height_int + 'px';\n\n    const f_focused = '1px solid ' + theme.primaryColor;\n    const f_not_focused = '1px solid ' + theme.secondaryBackgroundColor;\n\n    return (\n        <div\n          tabIndex={0}\n          style={\n            {\n              height:f_height,\n              width:'auto',\n              border:this.state.isFocused ? f_focused: f_not_focused,\n              borderRadius:'0.5em',\n              overflowY:'scroll',\n              overflowX:'hidden',\n              position: 'relative',\n              backgroundColor: theme.secondaryBackgroundColor\n            }\n          }\n          onFocus={this._onFocus}\n          onBlur={this._onBlur}\n        >\n          <textarea\n  style={\n    {\n      marginLeft:'0.5em',\n      fontFamily:font_fam,\n      marginTop:'0.2em',\n      whiteSpace: 'pre-wrap',\n      width:  'calc(100% - 1.2em)',\n      height: '100%',\n      border: 'none',\n      outline: 'none',\n      position: 'absolute',\n      backgroundColor: 'transparent',\n      color: theme.base === 'light' ? 'rgba(41,51,62,0.5)' : 'rgba(255,255,255,0.5)',\n      padding: '0'\n    }\n  }\n  value={this.state.suggestion}\n  readOnly\n  ref={(textarea) => { this.suggestionTextarea = textarea; }}\n/>\n          <textarea\n            style={\n            {\n              marginLeft:'0.5em',\n              fontFamily:font_fam,\n              marginTop:'0.2em',\n              whiteSpace: 'pre-wrap',\n              width:  'calc(100% - 1.2em)',\n              height: '100%',\n              border: 'none',\n              outline: 'none',\n              position: 'absolute',\n              backgroundColor: 'transparent',\n              color:theme.textColor,\n              padding: '0'\n            }\n          }\n            value={this.state.text}\n            onChange={this.onChange}\n            onKeyDown={this.onKeyDown}\n            onBlur={this._onTextAreaBlur}\n            onScroll={this.onScroll}\n            ref={(textarea) => { this.userTextarea = textarea; }}\n          />\n        </div>\n    )\n  }\n\n  public componentDidUpdate(): void {\n  if (this.userTextarea && this.suggestionTextarea) {\n    this.suggestionTextarea.scrollTop = this.userTextarea.scrollTop;\n  }\n}\nprivate onScroll = (): void => {\n    this.forceUpdate();\n  }\n  private onChange = (event: React.ChangeEvent<HTMLTextAreaElement>): void => {\n  const text = event.target.value\n  const api_upl = this.props.args[\"api_url\"]\n  this.setState({ text, suggestion: \"\" }, () => {\n    if (text.trim() !== \"\") {\n      this.callApi(text, api_upl).then(suggestion => {\n         if (this.state.text.trim() !== \"\") {\n          this.setState({ suggestion: this.state.text + suggestion })\n        }\n      })\n    }\n  })\n}\n\n\n  private onKeyDown = (event: React.KeyboardEvent<HTMLTextAreaElement>): void => {\n  if (event.key === 'Enter') {\n    event.preventDefault()\n    this.setState(prevState => ({\n      text: prevState.suggestion,\n      suggestion: ''\n    }), () => {\n      // Create a synthetic event and call onChange manually\n      const syntheticEvent = {\n        target: { value: this.state.text }\n      } as React.ChangeEvent<HTMLTextAreaElement>;\n      this.onChange(syntheticEvent);\n    })\n  }\n}\n\n  private _onTextAreaBlur = (): void => {\n    this.setState({ textAreaIsFocused: false }, () => {\n      Streamlit.setComponentValue(this.state.text);\n      this.setState({ suggestion: '' });\n    });\n  }\n\n  private _onFocus = (): void => {\n    this.setState({ isFocused: true })\n  }\n\n  private _onBlur = (): void => {\n    this.setState({ isFocused: false })\n  }\n\n  private abortController = new AbortController();\n\nprivate callApi = async (text: string, api_upl: string): Promise<string> => {\n  // Abort the previous request\n  this.abortController.abort();\n  this.abortController = new AbortController();\n\n  if (text.trim() === \"\") {\n    return \"\";\n  }\n\n  const currentMinute = Math.floor(Date.now() / 60000);\n  if (currentMinute > this.state.currentMinute) {\n    this.setState({\n      currentMinute: currentMinute,\n      requestsThisMinute: 0\n    });\n  } else if (this.state.requestsThisMinute > this.props.args[\"rpm_limit\"]) {\n    // Retry after 1 second if limit is exceeded\n    return new Promise((resolve) => {\n      setTimeout(() => {\n        resolve(this.callApi(text, api_upl));\n      }, 1000);\n    });\n  }\n\n  const {prompt_template, api_url, api_key, height, fontFamily, border, ...model_kwargs} = this.props.args;\n  const prompt = prompt_template.replace(\"{text}\", text); // format the prompt\n  \n  // Check if this is a Groq API call (chat completions format)\n  const isGroq = api_upl.includes('groq.com') || api_upl.includes('openai/v1/chat/completions');\n  \n  let payload;\n  if (isGroq) {\n    // Use chat completions format for Groq - only include valid parameters\n    const validParams: any = {};\n    if (model_kwargs.model) validParams.model = model_kwargs.model;\n    if (model_kwargs.max_tokens) validParams.max_tokens = model_kwargs.max_tokens;\n    if (model_kwargs.temperature) validParams.temperature = model_kwargs.temperature;\n    if (model_kwargs.top_p) validParams.top_p = model_kwargs.top_p;\n    if (model_kwargs.stop) validParams.stop = model_kwargs.stop;\n    \n    payload = {\n      messages: [\n        {\n          role: \"user\",\n          content: prompt\n        }\n      ],\n      ...validParams,\n      stream: false\n    };\n  } else {\n    // Use legacy completions format for other APIs\n    payload = {\n      prompt: prompt,\n      ...model_kwargs,\n      echo: false\n    };\n  }\n  \n  const headers: Record<string, string> = {\n    'Content-Type': 'application/json'\n  };\n  \n  // Add API key if provided\n  if (api_key) {\n    headers['Authorization'] = `Bearer ${api_key}`;\n  }\n\n  try {\n    const response = await fetch(api_upl, {\n      method: \"POST\",\n      headers: headers,\n      body: JSON.stringify(payload),\n      signal: this.abortController.signal\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      console.error(\"API Error Response:\", errorText);\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    this.setState(prevState => ({\n    requestsThisMinute: prevState.requestsThisMinute + 1\n  }));\n\n    const responseJson = await response.json();\n    \n    // Handle both chat completions and legacy completions formats\n    if (isGroq && responseJson.choices && responseJson.choices[0] && responseJson.choices[0].message) {\n      return responseJson.choices[0].message.content;\n    } else if (responseJson.choices && responseJson.choices[0] && responseJson.choices[0].text) {\n      return responseJson.choices[0].text;\n    } else {\n      console.error(\"Unexpected response format:\", responseJson);\n      return \"\";\n    }\n  } catch (error: any) {\n    if (error.name === 'AbortError') {\n      return \"\";  // Return empty string if request was aborted\n    }\n    console.error(\"Error decoding response\", error);\n    return \"\";\n  }\n}\n}\n\nexport default withStreamlitConnection(Copilot)\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}