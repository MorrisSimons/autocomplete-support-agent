(this.webpackJsonpstreamlit_copilot=this.webpackJsonpstreamlit_copilot||[]).push([[0],{12:function(e,t,s){"use strict";s.r(t);var o=s(0),r=s.n(o),a=s(3),n=s.n(a),i=s(1);class l extends i.b{constructor(){super(...arguments),this.userTextarea=null,this.suggestionTextarea=null,this.state={text:"",suggestion:"",isFocused:!1,textAreaIsFocused:!1,requestsThisMinute:0,currentMinute:Math.floor(Date.now()/6e4),totalRequests:0,successfulRequests:0,failedRequests:0},this.render=()=>{const{theme:e}=this.props;if(!e)return r.a.createElement("div",null,"Theme is undefined, please check streamlit version.");const t=this.props.args.height,s=e.font,o=t+"px",a="1px solid "+e.primaryColor,n="1px solid "+e.secondaryBackgroundColor;return r.a.createElement("div",null,r.a.createElement("div",{style:{fontSize:"0.8em",color:e.textColor,marginBottom:"0.5em",padding:"0.5em",backgroundColor:e.backgroundColor,borderRadius:"0.3em",border:"1px solid "+e.secondaryBackgroundColor,display:"flex",justifyContent:"space-between",alignItems:"center"}},r.a.createElement("div",null,"\ud83d\udcca ",r.a.createElement("strong",null,"API Stats:")," Total: ",this.state.totalRequests," | \u2705 Success: ",this.state.successfulRequests," | \u274c Failed: ",this.state.failedRequests," | \u23f1\ufe0f This minute: ",this.state.requestsThisMinute,"/",this.props.args.rpm_limit),r.a.createElement("button",{onClick:this.resetCounters,style:{fontSize:"0.7em",padding:"0.2em 0.5em",backgroundColor:e.primaryColor,color:"white",border:"none",borderRadius:"0.3em",cursor:"pointer"},title:"Reset counters"},"\ud83d\udd04 Reset")),r.a.createElement("div",{tabIndex:0,style:{height:o,width:"auto",border:this.state.isFocused?a:n,borderRadius:"0.5em",overflowY:"scroll",overflowX:"hidden",position:"relative",backgroundColor:e.secondaryBackgroundColor},onFocus:this._onFocus,onBlur:this._onBlur},r.a.createElement("textarea",{style:{marginLeft:"0.5em",fontFamily:s,marginTop:"0.2em",whiteSpace:"pre-wrap",width:"calc(100% - 1.2em)",height:"100%",border:"none",outline:"none",position:"absolute",backgroundColor:"transparent",color:"light"===e.base?"rgba(41,51,62,0.5)":"rgba(255,255,255,0.5)",padding:"0"},value:this.state.suggestion,readOnly:!0,ref:e=>{this.suggestionTextarea=e}}),r.a.createElement("textarea",{style:{marginLeft:"0.5em",fontFamily:s,marginTop:"0.2em",whiteSpace:"pre-wrap",width:"calc(100% - 1.2em)",height:"100%",border:"none",outline:"none",position:"absolute",backgroundColor:"transparent",color:e.textColor,padding:"0"},value:this.state.text,onChange:this.onChange,onKeyDown:this.onKeyDown,onBlur:this._onTextAreaBlur,onScroll:this.onScroll,ref:e=>{this.userTextarea=e}})))},this.onScroll=()=>{this.forceUpdate()},this.onChange=e=>{const t=e.target.value,s=this.props.args.api_url;this.setState({text:t,suggestion:""},()=>{""!==t.trim()&&this.callApi(t,s).then(e=>{""!==this.state.text.trim()&&this.setState({suggestion:this.state.text+e})})})},this.onKeyDown=e=>{"Enter"===e.key&&(e.preventDefault(),this.setState(e=>({text:e.suggestion,suggestion:""}),()=>{const e={target:{value:this.state.text}};this.onChange(e)}))},this._onTextAreaBlur=()=>{this.setState({textAreaIsFocused:!1},()=>{i.a.setComponentValue(this.state.text),this.setState({suggestion:""})})},this._onFocus=()=>{this.setState({isFocused:!0})},this._onBlur=()=>{this.setState({isFocused:!1})},this.resetCounters=()=>{this.setState({totalRequests:0,successfulRequests:0,failedRequests:0,requestsThisMinute:0})},this.abortController=new AbortController,this.callApi=async(e,t)=>{if(this.abortController.abort(),this.abortController=new AbortController,""===e.trim())return"";const s=Math.floor(Date.now()/6e4);if(s>this.state.currentMinute)this.setState({currentMinute:s,requestsThisMinute:0});else if(this.state.requestsThisMinute>this.props.args.rpm_limit)return new Promise(s=>{setTimeout(()=>{s(this.callApi(e,t))},1e3)});const{prompt_template:o,api_url:r,api_key:a,height:n,fontFamily:i,border:l,...c}=this.props.args,u=o.replace("{text}",e),h=t.includes("groq.com")||t.includes("openai/v1/chat/completions");let p;if(h){const e={};c.model&&(e.model=c.model),c.max_tokens&&(e.max_tokens=c.max_tokens),c.temperature&&(e.temperature=c.temperature),c.top_p&&(e.top_p=c.top_p),c.stop&&(e.stop=c.stop),p={messages:[{role:"user",content:u}],...e,stream:!1}}else p={prompt:u,...c,echo:!1};const d={"Content-Type":"application/json"};a&&(d.Authorization="Bearer ".concat(a));try{console.log("\ud83d\ude80 Making API call to:",t),console.log("\ud83d\udce4 Request payload:",p),console.log("\ud83d\udd11 Headers:",d),this.setState(e=>({totalRequests:e.totalRequests+1}));const e=await fetch(t,{method:"POST",headers:d,body:JSON.stringify(p),signal:this.abortController.signal});if(console.log("\ud83d\udce1 Response status:",e.status),console.log("\ud83d\udce1 Response headers:",e.headers),!e.ok){const t=await e.text();throw console.error("\u274c API Error Response:",t),this.setState(e=>({failedRequests:e.failedRequests+1})),new Error("HTTP error! status: ".concat(e.status))}this.setState(e=>({requestsThisMinute:e.requestsThisMinute+1,successfulRequests:e.successfulRequests+1}));const s=await e.json();return h&&s.choices&&s.choices[0]&&s.choices[0].message?s.choices[0].message.content:s.choices&&s.choices[0]&&s.choices[0].text?s.choices[0].text:(console.error("Unexpected response format:",s),"")}catch(m){return m instanceof Error&&"AbortError"===m.name||console.error("Error decoding response",m),""}}}componentDidUpdate(){this.userTextarea&&this.suggestionTextarea&&(this.suggestionTextarea.scrollTop=this.userTextarea.scrollTop)}}var c=Object(i.c)(l);n.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(c,null)),document.getElementById("root"))},5:function(e,t,s){e.exports=s(12)}},[[5,1,2]]]);
//# sourceMappingURL=main.06ba8fc5.chunk.js.map