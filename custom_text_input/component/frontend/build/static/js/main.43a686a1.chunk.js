(this.webpackJsonpstreamlit_copilot=this.webpackJsonpstreamlit_copilot||[]).push([[0],{12:function(t,e,s){"use strict";s.r(e);var o=s(0),r=s.n(o),i=s(3),a=s.n(i),n=s(1);class l extends n.b{constructor(){super(...arguments),this.userTextarea=null,this.suggestionTextarea=null,this.state={text:"",suggestion:"",isFocused:!1,textAreaIsFocused:!1,requestsThisMinute:0,currentMinute:Math.floor(Date.now()/6e4),totalRequests:0,successfulRequests:0,failedRequests:0,inputCost:0,outputCost:0,totalCost:0},this.render=()=>{const{theme:t}=this.props;if(!t)return r.a.createElement("div",null,"Theme is undefined, please check streamlit version.");const e=this.props.args.height,s=t.font,o=e+"px",i="1px solid "+t.primaryColor,a="1px solid "+t.secondaryBackgroundColor;return r.a.createElement("div",null,r.a.createElement("div",{style:{fontSize:"1em",color:t.textColor,marginBottom:"0.5em",padding:"0.5em",backgroundColor:t.backgroundColor,borderRadius:"0.3em",border:"1px solid "+t.secondaryBackgroundColor,display:"flex",justifyContent:"space-between",alignItems:"center"}},r.a.createElement("div",null,r.a.createElement("strong",null,"API Stats:")," Total: ",this.state.totalRequests," | \u2705 Success: ",this.state.successfulRequests," | \u274c Failed: ",this.state.failedRequests," |","Requests this per minute / limit: ",this.state.requestsThisMinute," / ",this.props.args.rpm_limit,r.a.createElement("br",null),r.a.createElement("strong",null,"Cost:")," Input: $",this.state.inputCost.toFixed(6)," | Output: $",this.state.outputCost.toFixed(6)," | Total: $",this.state.totalCost.toFixed(6)),r.a.createElement("button",{onClick:this.resetCounters,style:{fontSize:"0.7em",padding:"0.2em 0.5em",backgroundColor:t.primaryColor,color:"white",border:"none",borderRadius:"0.3em",cursor:"pointer"},title:"Reset counters"},"\ud83d\udd04 Reset")),r.a.createElement("div",{tabIndex:0,style:{height:o,width:"auto",border:this.state.isFocused?i:a,borderRadius:"0.5em",overflowY:"scroll",overflowX:"hidden",position:"relative",backgroundColor:t.secondaryBackgroundColor},onFocus:this._onFocus,onBlur:this._onBlur},r.a.createElement("textarea",{style:{marginLeft:"0.5em",fontFamily:s,marginTop:"0.2em",whiteSpace:"pre-wrap",width:"calc(100% - 1.2em)",height:"100%",border:"none",outline:"none",position:"absolute",backgroundColor:"transparent",color:"light"===t.base?"rgba(41,51,62,0.5)":"rgba(255,255,255,0.5)",padding:"0"},value:this.state.suggestion,readOnly:!0,ref:t=>{this.suggestionTextarea=t}}),r.a.createElement("textarea",{style:{marginLeft:"0.5em",fontFamily:s,marginTop:"0.2em",whiteSpace:"pre-wrap",width:"calc(100% - 1.2em)",height:"100%",border:"none",outline:"none",position:"absolute",backgroundColor:"transparent",color:t.textColor,padding:"0"},value:this.state.text,onChange:this.onChange,onKeyDown:this.onKeyDown,onBlur:this._onTextAreaBlur,onScroll:this.onScroll,ref:t=>{this.userTextarea=t}})))},this.onScroll=()=>{this.forceUpdate()},this.onChange=t=>{const e=t.target.value,s=this.props.args.api_url;this.setState({text:e,suggestion:""},()=>{""!==e.trim()&&this.callApi(e,s).then(t=>{""!==this.state.text.trim()&&this.setState({suggestion:this.state.text+t})})})},this.onKeyDown=t=>{"Tab"===t.key&&(t.preventDefault(),this.setState(t=>({text:t.suggestion,suggestion:""}),()=>{const t={target:{value:this.state.text}};this.onChange(t)}))},this._onTextAreaBlur=()=>{this.setState({textAreaIsFocused:!1},()=>{n.a.setComponentValue(this.state.text),this.setState({suggestion:""})})},this._onFocus=()=>{this.setState({isFocused:!0})},this._onBlur=()=>{this.setState({isFocused:!1})},this.resetCounters=()=>{this.setState({totalRequests:0,successfulRequests:0,failedRequests:0,requestsThisMinute:0,inputCost:0,outputCost:0,totalCost:0})},this.abortController=new AbortController,this.callApi=async(t,e)=>{if(this.abortController.abort(),this.abortController=new AbortController,""===t.trim())return"";const s=Math.floor(Date.now()/6e4);if(s>this.state.currentMinute)this.setState({currentMinute:s,requestsThisMinute:0});else if(this.state.requestsThisMinute>this.props.args.rpm_limit)return new Promise(s=>{setTimeout(()=>{s(this.callApi(t,e))},1e3)});const{prompt_template:o,api_url:r,api_key:i,height:a,fontFamily:n,border:l,text:u,question_title:c,...h}=this.props.args,p=o.replace("{text}",u||"").replace("{question_title}",c||""),d="chat"===this.props.args.api_format||e.includes("/chat/completions");let m;if(d){const t={};h.model&&(t.model=h.model),h.max_tokens&&(t.max_tokens=h.max_tokens),h.temperature&&(t.temperature=h.temperature),h.top_p&&(t.top_p=h.top_p),h.stop&&(t.stop=h.stop),m={messages:[{role:"user",content:p}],...t,stream:!1}}else m={prompt:p,...h,echo:!1};const g={"Content-Type":"application/json"};i&&(g.Authorization="Bearer ".concat(i));try{var C,x;this.setState(t=>({totalRequests:t.totalRequests+1}));const t=await fetch(e,{method:"POST",headers:g,body:JSON.stringify(m),signal:this.abortController.signal});if(!t.ok){const e=await t.text();throw console.error("API Error Response:",e),this.setState(t=>({failedRequests:t.failedRequests+1})),new Error("HTTP error! status: ".concat(t.status))}this.setState(t=>({requestsThisMinute:t.requestsThisMinute+1,successfulRequests:t.successfulRequests+1}));const s=await t.json(),o=(null===(C=s.usage)||void 0===C?void 0:C.prompt_tokens)||0,r=(null===(x=s.usage)||void 0===x?void 0:x.completion_tokens)||0,i=this.props.args.token_cost||.05,a=this.props.args.output_token_cost||.1,n=o||Math.ceil(p.length/4),l=n/1e6*i,u=(r||0)/1e6*a;return this.setState(t=>({inputCost:t.inputCost+l,outputCost:t.outputCost+u,totalCost:t.totalCost+l+u})),d&&s.choices&&s.choices[0]&&s.choices[0].message?s.choices[0].message.content:s.choices&&s.choices[0]&&s.choices[0].text?s.choices[0].text:(console.error("Unexpected response format:",s),"")}catch(f){return f instanceof Error&&"AbortError"===f.name||console.error("Error decoding response",f),""}}}componentDidUpdate(){this.userTextarea&&this.suggestionTextarea&&(this.suggestionTextarea.scrollTop=this.userTextarea.scrollTop)}}var u=Object(n.c)(l);a.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(u,null)),document.getElementById("root"))},5:function(t,e,s){t.exports=s(12)}},[[5,1,2]]]);
//# sourceMappingURL=main.43a686a1.chunk.js.map